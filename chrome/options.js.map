{"version":3,"file":"options.js","sources":["../src/options/options.ts"],"sourcesContent":["import {\n  loadAllSettings,\n  saveSetting,\n  resetAllSettings,\n  notifyContentScripts,\n  DEFAULT_SETTINGS,\n} from \"../lib/settings.js\";\n\n// DOM element references\nconst globalEnabled = document.getElementById(\n  \"global-enabled\"\n) as HTMLInputElement;\nconst kalshiEnabled = document.getElementById(\n  \"kalshi-enabled\"\n) as HTMLInputElement;\nconst kalshiDisplayMode = document.getElementById(\n  \"kalshi-display-mode\"\n) as HTMLSelectElement;\nconst kalshiHideCharts = document.getElementById(\n  \"kalshi-hide-charts\"\n) as HTMLInputElement;\nconst kalshiFeeMode = document.getElementById(\n  \"kalshi-fee-mode\"\n) as HTMLSelectElement;\nconst kalshiCustomFee = document.getElementById(\n  \"kalshi-custom-fee\"\n) as HTMLInputElement;\nconst customFeeGroup = document.getElementById(\n  \"custom-fee-group\"\n) as HTMLDivElement;\nconst debugMode = document.getElementById(\"debug-mode\") as HTMLInputElement;\nconst resetButton = document.getElementById(\n  \"reset-settings\"\n) as HTMLButtonElement;\n\n/**\n * Load all settings from storage and update UI\n */\nasync function loadSettings(): Promise<void> {\n  try {\n    const settings = await loadAllSettings();\n\n    // Global settings\n    globalEnabled.checked = settings[\"global.extensionEnabled\"] !== false;\n    debugMode.checked = settings[\"debug.enabled\"] === true;\n\n    // Kalshi settings\n    kalshiEnabled.checked = settings[\"kalshi.extensionEnabled\"] !== false;\n    kalshiDisplayMode.value = settings[\"kalshi.oddsDisplayMode\"] || \"american\";\n    kalshiHideCharts.checked = settings[\"kalshi.hideCharts\"] !== false;\n    kalshiFeeMode.value = settings[\"kalshi.feeDisplayMode\"] || \"taker\";\n    kalshiCustomFee.value = String(settings[\"kalshi.customFeeRate\"] ?? 0.07);\n    customFeeGroup.style.display =\n      kalshiFeeMode.value === \"custom\" ? \"block\" : \"none\";\n\n    console.log(\"Settings loaded:\", settings);\n  } catch (error) {\n    console.error(\"Failed to load settings:\", error);\n  }\n}\n\n/**\n * Reset all settings to defaults with confirmation\n */\nasync function handleResetSettings(): Promise<void> {\n  const confirmed = confirm(\n    \"Are you sure you want to reset all settings to their defaults? This cannot be undone.\"\n  );\n\n  if (!confirmed) return;\n\n  try {\n    await resetAllSettings();\n    await loadSettings(); // Reload UI\n    await notifyContentScripts({ type: \"settingsReset\" });\n\n    alert(\"All settings have been reset to defaults.\");\n  } catch (error) {\n    console.error(\"Failed to reset settings:\", error);\n    alert(\"Failed to reset settings. Please try again.\");\n  }\n}\n\n/**\n * Setup event listeners for all controls\n */\nfunction setupEventListeners(): void {\n  // Global settings\n  globalEnabled.addEventListener(\"change\", async () => {\n    await saveSetting(\"global.extensionEnabled\", globalEnabled.checked);\n  });\n\n  debugMode.addEventListener(\"change\", async () => {\n    await saveSetting(\"debug.enabled\", debugMode.checked);\n  });\n\n  // Kalshi settings\n  kalshiEnabled.addEventListener(\"change\", async () => {\n    await saveSetting(\"kalshi.extensionEnabled\", kalshiEnabled.checked);\n  });\n\n  kalshiDisplayMode.addEventListener(\"change\", async () => {\n    await saveSetting(\"kalshi.oddsDisplayMode\", kalshiDisplayMode.value);\n    await notifyContentScripts({\n      type: \"displayModeChanged\",\n      mode: kalshiDisplayMode.value,\n    });\n  });\n\n  kalshiHideCharts.addEventListener(\"change\", async () => {\n    await saveSetting(\"kalshi.hideCharts\", kalshiHideCharts.checked);\n    await notifyContentScripts({\n      type: \"hideChartsChanged\",\n      hide: kalshiHideCharts.checked,\n    });\n  });\n\n  kalshiFeeMode.addEventListener(\"change\", async () => {\n    await saveSetting(\"kalshi.feeDisplayMode\", kalshiFeeMode.value);\n    customFeeGroup.style.display =\n      kalshiFeeMode.value === \"custom\" ? \"block\" : \"none\";\n    await notifyContentScripts({\n      type: \"feeSettingsChanged\",\n      mode: kalshiFeeMode.value,\n      customRate: parseFloat(kalshiCustomFee.value),\n    });\n  });\n\n  kalshiCustomFee.addEventListener(\"change\", async () => {\n    // Clamp to [0, 0.10]\n    const rate = Math.max(\n      0,\n      Math.min(0.1, parseFloat(kalshiCustomFee.value) || 0.07)\n    );\n    kalshiCustomFee.value = rate.toFixed(2);\n    await saveSetting(\"kalshi.customFeeRate\", rate);\n\n    // Only notify if custom mode is active\n    if (kalshiFeeMode.value === \"custom\") {\n      await notifyContentScripts({\n        type: \"feeSettingsChanged\",\n        mode: \"custom\",\n        customRate: rate,\n      });\n    }\n  });\n\n  // Reset button\n  resetButton.addEventListener(\"click\", handleResetSettings);\n}\n\n/**\n * Initialize the options page\n */\nasync function initialize(): Promise<void> {\n  console.log(\"Initializing options page...\");\n\n  try {\n    await loadSettings();\n    setupEventListeners();\n\n    console.log(\"Options page ready.\");\n  } catch (error) {\n    console.error(\"Failed to initialize options page:\", error);\n  }\n}\n\n// Initialize when DOM is ready\nif (document.readyState === \"loading\") {\n  document.addEventListener(\"DOMContentLoaded\", initialize);\n} else {\n  initialize();\n}\n"],"names":[],"mappings":"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"}