(function(x,M){"use strict";const q=t=>{let o=location.href;new MutationObserver(()=>{const n=location.href;n!==o&&(o=n,t(n))}).observe(document,{subtree:!0,childList:!0})},U="-10000",X=50,V=100,S={PRICE_ELEMENTS:"button, span, div, td, th, p",PRICE_BUTTONS:'button[data-testid="price-pill"]',SPREAD_CONTAINERS:".flex.items-center.gap-2.w-full, div.flex.items-center.gap-2.w-full, [class*='flex'][class*='items-center'][class*='gap-2'][class*='w-full']",TITLE_ELEMENTS:'h1, h2, h3, .title, [class*="title"], [class*="header"]',GAP_ELEMENTS:'div[class="flex flex-col gap-7 w-full"]'},C={ODDS_SPAN:"bb-odds",SPREAD_OVERLAY:"bb-spread-overlay",HIDE_SVGS:"bb-hide-svgs"},a={PROCESSED:"bbProcessed",ORIGINAL_TEXT:"bbOriginalText",SPREAD_PROCESSED:"bbSpreadProcessed",HIDDEN_CHART:"bbHiddenChart",HIDDEN_CHART_SIBLING:"bbHiddenChartSibling",MODIFIED_GAP:"bbModifiedGap",ORIGINAL_CLASS:"bbOriginalClass"},f={CENTS:/(\d{1,2}(?:\.\d+)?)¢/,PERCENTAGE:/(\d{1,2}(?:\.\d+)?)% chance/,TEAM_NAMES:/([\w\s.'-]+?)\s+(?:vs?\.?|@|v|at)\s+([\w\s.'-]+)/i,CONTENT_TEAM_NAMES:/([\w\s.'-]+?)\s+(?:vs?\.?|@|against|at)\s+([\w\s.'-]+)/i,SPREAD_MAIN:/([\w\s.'-]+?)\s+wins\s+by\s+(?:over|under)\s*(\d+(?:\.\d+)?)\s*(?:points?|goals?|runs?)/i,SPREAD_ALT1:/([\w\s.'-]+?)\s+wins\s+by\s+(?:more\s+than|fewer\s+than)\s+(\d+(?:\.\d+)?)\s+(?:points?|goals?|runs?)/i,SPREAD_ALT2:/([\w\s.'-]+?)\s+covers\s+(?:the\s+)?(\d+(?:\.\d+)?)\s*(?:point\s+)?spread/i},K=["wins by","points","goals","runs","over","under","covers","spread"];let I=!0,y="both",w=!0,L="taker",D=.07;async function Y(){try{const e=await(await Promise.resolve().then(()=>H)).default.storage.local.get(["kalshi.extensionEnabled","kalshi.oddsDisplayMode","kalshi.hideCharts","kalshi.feeDisplayMode","kalshi.customFeeRate"]);I=e["kalshi.extensionEnabled"]!==!1,y=e["kalshi.oddsDisplayMode"]||"american",w=e["kalshi.hideCharts"]!==!1,L=e["kalshi.feeDisplayMode"]||"taker",D=e["kalshi.customFeeRate"]??.07}catch(t){console.warn("[BBC] Could not load settings:",t),I=!0,y="american",w=!0,L="taker",D=.07}}function h(){return I}function G(){return y}function R(){return w}function z(t){y=t}function W(t){w=t}function j(){switch(L){case"taker":return .07;case"maker":return .0175;case"raw":return 0;case"custom":return Math.max(0,Math.min(.1,D))}}function J(t){L=t}function Q(t){D=Math.max(0,Math.min(.1,t))}function N(){if(!R())return;let t=document.getElementById(C.HIDE_SVGS);t||(t=document.createElement("style"),t.id=C.HIDE_SVGS,document.head.appendChild(t)),t.textContent=`
    div:has(span:contains("vol")) {
      display: none !important;
    }
  `,document.querySelectorAll("svg").forEach(n=>{if(n.querySelector("g")){const s=n.parentElement;if(s&&s.parentElement){const r=s.parentElement;if(r.style.setProperty("display","none","important"),r.dataset[a.HIDDEN_CHART.toLowerCase()]="true",r.parentElement){const l=r.parentElement.children;Array.from(l).forEach(c=>{if(c!==r&&c.tagName==="DIV"){const d=c;d.style.setProperty("display","none","important"),d.dataset[a.HIDDEN_CHART_SIBLING.toLowerCase()]="true"}})}}}}),document.querySelectorAll(S.GAP_ELEMENTS).forEach(n=>{const s=n;s.dataset[a.ORIGINAL_CLASS.toLowerCase()]=s.className,s.className="flex flex-col gap-3 w-full",s.dataset[a.MODIFIED_GAP.toLowerCase()]="true"})}function Z(){const t=document.getElementById(C.HIDE_SVGS);t&&t.remove(),document.querySelectorAll(`[data-${a.HIDDEN_CHART.toLowerCase()}]`).forEach(o=>{const e=o;e.style.display="",delete e.dataset[a.HIDDEN_CHART.toLowerCase()]}),document.querySelectorAll(`[data-${a.HIDDEN_CHART_SIBLING.toLowerCase()}]`).forEach(o=>{const e=o;e.style.display="",delete e.dataset[a.HIDDEN_CHART_SIBLING.toLowerCase()]}),document.querySelectorAll(`[data-${a.MODIFIED_GAP.toLowerCase()}]`).forEach(o=>{const e=o,n=e.dataset[a.ORIGINAL_CLASS.toLowerCase()];n&&(e.className=n,delete e.dataset[a.ORIGINAL_CLASS.toLowerCase()]),delete e.dataset[a.MODIFIED_GAP.toLowerCase()]})}function _(t,o=!0){let e=t/100;if(o){const s=j()*e*(1-e);e=e+s}return e<=0||e>=1?U:e>=.5?`-${Math.round(e/(1-e)*100)}`:`+${Math.round((1-e)/e*100)}`}function k(t,o){const n=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,{acceptNode:s=>{var r,l;return(r=s.textContent)!=null&&r.includes("¢")||(l=s.textContent)!=null&&l.includes("% chance")?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}}).nextNode();if(n){const s=n.textContent||"";o(n,s)}}function ee(t,o){if(!o.parentNode)return;const e=document.createElement("span");e.className=C.ODDS_SPAN,e.style.marginLeft="4px",e.style.pointerEvents="none",e.textContent=`(${t})`,o.parentNode.insertBefore(e,o.nextSibling)}function b(t,o,e){const n=t.querySelector(`.${C.SPREAD_OVERLAY}`);n&&n.remove();const s=document.createElement("div");s.className=C.SPREAD_OVERLAY;const r=e?"var(--blue-x10)":"var(--purple-x10)";s.style.cssText=`
    position: absolute;
    top: -20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 12px;
    font-weight: 600;
    white-space: nowrap;
    pointer-events: none;
    color: ${r};
  `,s.textContent=o,window.getComputedStyle(t).position==="static"&&(t.style.position="relative"),t.appendChild(s),t.dataset[a.SPREAD_PROCESSED]="true"}function te(){document.querySelectorAll(`.${C.ODDS_SPAN}`).forEach(t=>t.remove()),document.querySelectorAll(`.${C.SPREAD_OVERLAY}`).forEach(t=>t.remove()),document.querySelectorAll(`[data-${a.PROCESSED.toLowerCase()}]`).forEach(t=>{const o=t,e=o.dataset[a.ORIGINAL_TEXT.toLowerCase()],n=o.firstChild,s=(n==null?void 0:n.textContent)??"",r=f.CENTS.test(s)||f.PERCENTAGE.test(s);e&&(r&&s!==e?o.dataset[a.ORIGINAL_TEXT.toLowerCase()]=s:(n==null?void 0:n.nodeType)===Node.TEXT_NODE&&(n.textContent=e,delete o.dataset[a.ORIGINAL_TEXT.toLowerCase()])),delete o.dataset[a.PROCESSED.toLowerCase()],o.style.color="",o.style.fontWeight=""}),document.querySelectorAll(`[data-${a.SPREAD_PROCESSED.toLowerCase()}]`).forEach(t=>{const o=t;delete o.dataset[a.SPREAD_PROCESSED.toLowerCase()]})}function ne(t){var d,E,u;if(!h()||t.querySelector(".bb-odds")||t.dataset[a.PROCESSED.toLowerCase()])return;const o=((d=t.textContent)==null?void 0:d.trim())||"",e=o.match(f.CENTS),n=o.match(f.PERCENTAGE);if(!e&&!n||o.length>=30)return;const s=t;let r;const l=((u=(E=s.closest("div"))==null?void 0:E.textContent)==null?void 0:u.includes("Average price"))||!1;if(e){const i=parseFloat(e[1]);r=_(i,!l)}else if(n){const i=parseFloat(n[1]);r=_(i,!l)}else return;switch(G()){case"american":k(t,(i,p)=>{s.dataset[a.ORIGINAL_TEXT.toLowerCase()]=p,e?i.textContent=p.replace(/\d{1,2}(?:\.\d+)?¢/,r):n&&(i.textContent=p.replace(/\d{1,2}(?:\.\d+)?% chance/,r)),s.dataset[a.PROCESSED.toLowerCase()]="true"});break;case"price":s.dataset[a.PROCESSED.toLowerCase()]="true";break;case"both":k(t,i=>{ee(r,i),s.dataset[a.PROCESSED.toLowerCase()]="true"});break}}function oe(t,o){var d,E;const e=o.match(f.CENTS),n=o.match(f.PERCENTAGE);if(!e&&!n)return;const s=((E=(d=t.closest("div"))==null?void 0:d.textContent)==null?void 0:E.includes("Average price"))||!1;let r;if(e){const u=parseFloat(e[1]);r=_(u,!s)}else if(n){const u=parseFloat(n[1]);r=_(u,!s)}else return;const l=t.firstChild;if(!l||l.nodeType!==Node.TEXT_NODE)return;switch(G()){case"american":e?l.textContent=o.replace(/\d{1,2}(?:\.\d+)?¢/,r):n&&(l.textContent=o.replace(/\d{1,2}(?:\.\d+)?% chance/,r));break;case"price":l.textContent=o;break;case"both":l.textContent=o;const u=t.querySelector(".bb-odds");u==null||u.remove();const i=document.createElement("span");i.className="bb-odds",i.style.marginLeft="4px",i.textContent=`(${r})`,t.appendChild(i);break}}function se(t){var c;const o=t.dataset[a.ORIGINAL_TEXT.toLowerCase()],e=((c=t.textContent)==null?void 0:c.trim())||"";if(!o)return!1;const n=o.match(f.CENTS),s=e.match(f.CENTS),r=o.match(f.PERCENTAGE),l=e.match(f.PERCENTAGE);return s&&n&&s[1]!==n[1]||l&&r&&l[1]!==r[1]?(t.dataset[a.ORIGINAL_TEXT.toLowerCase()]=e,delete t.dataset[a.PROCESSED.toLowerCase()],!0):!1}function P(t=!1){if(!h())return;document.querySelectorAll(S.PRICE_ELEMENTS).forEach(e=>{var s,r;const n=e;if(n.dataset[a.ORIGINAL_TEXT.toLowerCase()]){const l=se(n),c=n.dataset[a.ORIGINAL_TEXT.toLowerCase()];(t||l||!n.dataset[a.PROCESSED.toLowerCase()])&&oe(n,c)}else(e.children.length===0||e.children.length===1&&(((s=e.textContent)==null?void 0:s.includes("¢"))||((r=e.textContent)==null?void 0:r.includes("% chance"))))&&ne(e)})}async function re(t){try{const{default:o}=await Promise.resolve().then(()=>H);o.runtime.onMessage.addListener(e=>{e.type==="displayModeChanged"?(z(e.mode),t()):e.type==="hideChartsChanged"?(W(e.hide),e.hide?N():Z()):e.type==="feeSettingsChanged"&&(J(e.mode),e.mode==="custom"&&e.customRate!==void 0&&Q(e.customRate),P(!0),t())})}catch(o){console.warn("[BBC] Could not set up message listener:",o)}}let m=null;function ae(){if(m)return m;const t=document.querySelectorAll(S.TITLE_ELEMENTS);for(const n of t){const r=(n.textContent||"").match(f.TEAM_NAMES);if(r){const l=r[1].trim(),c=r[2].trim();return m={team1:l,team2:c},m}}const e=(document.body.textContent||"").match(f.CONTENT_TEAM_NAMES);if(e){const n=e[1].trim(),s=e[2].trim();return m={team1:n,team2:s},m}return null}function ce(){m=null}let T=new Map;function $(t){const o=[f.SPREAD_ALT1,f.SPREAD_ALT2];let e=t.match(f.SPREAD_MAIN);if(!e){for(const d of o)if(e=t.match(d),e)break}if(!e||t.length<15||!K.some(d=>t.toLowerCase().includes(d)))return null;const s=e[1].trim(),r=parseFloat(e[2]);let l="Opponent";const c=ae();return c&&(c.team1.toLowerCase().includes(s.toLowerCase())?l=c.team2:c.team2.toLowerCase().includes(s.toLowerCase())&&(l=c.team1)),{favoriteTeam:s,underdogTeam:l,spread:r,isSpread:!0}}function le(){if(!h())return;document.querySelectorAll(S.SPREAD_CONTAINERS).forEach(o=>{var s;const e=((s=o.textContent)==null?void 0:s.trim())||"";if(!(e.toLowerCase().includes("wins by")&&(e.toLowerCase().includes("points")||e.toLowerCase().includes("goals")||e.toLowerCase().includes("runs"))))return;const n=$(e);if(n){const r=`${n.favoriteTeam}-${n.underdogTeam}-${n.spread}`;if(T.get(r)===e)return;T.set(r,e);const c=o.querySelectorAll(S.PRICE_BUTTONS);if(c.length<2)return;let d=null,E=null;if(c.forEach(u=>{var A;const i=u,p=((A=i.textContent)==null?void 0:A.toLowerCase().trim())||"";p.includes("yes")&&!d?d=i:p.includes("no")&&!E&&(E=i)}),d&&E){const u=`${n.favoriteTeam} -${n.spread}`,i=`${n.underdogTeam} +${n.spread}`;b(d,u,!0),b(E,i,!1)}}})}function ie(){if(!h())return;document.querySelectorAll("span").forEach(o=>{var n;const e=((n=o.textContent)==null?void 0:n.trim())||"";if(e.includes("Buy Yes")||e.includes("Buy No")){const s=$(e);if(s){const r=`individual-${s.favoriteTeam}-${s.underdogTeam}-${s.spread}`;if(T.get(r)===e)return;T.set(r,e);let c=o.parentElement;for(;c&&!c.querySelector(S.PRICE_BUTTONS)&&(c=c.parentElement,!(!c||c===document.body)););if(c){const d=c.querySelectorAll(S.PRICE_BUTTONS);if(d.length>=2){let E=null,u=null;if(d.forEach(i=>{var F;const p=i,A=((F=p.textContent)==null?void 0:F.toLowerCase().trim())||"";A.includes("yes")&&!E?E=p:A.includes("no")&&!u&&(u=p)}),E&&u&&!E.dataset[a.SPREAD_PROCESSED.toLowerCase()]){const i=`${s.favoriteTeam} -${s.spread}`,p=`${s.underdogTeam} +${s.spread}`;E.style.marginTop="8px",u.style.marginTop="8px",b(E,i,!0),b(u,p,!1)}}}}}})}function de(){T.clear()}let O;function v(){O&&clearTimeout(O),O=window.setTimeout(g,X)}function B(){h()&&(P(),le(),ie())}function g(){te(),de(),h()&&B()}function ue(){new MutationObserver(()=>{clearTimeout(window.kalshiConvertTimeout),window.kalshiConvertTimeout=setTimeout(()=>{g(),R()&&N()},V)}).observe(document.body,{childList:!0,subtree:!0,characterData:!0})}function Ee(){Y().then(()=>{P(),R()&&N(),B(),g(),re(v),q(()=>{ce(),v(),R()&&N()}),ue()})}try{/(^|\.)kalshi\.com$/i.test(location.hostname)&&Ee()}catch(t){console.error("[BBC] Content script initialization error:",t)}const{storage:fe,runtime:pe,tabs:Ce}=M,H=Object.freeze(Object.defineProperty({__proto__:null,default:M,runtime:pe,storage:fe,tabs:Ce},Symbol.toStringTag,{value:"Module"}));x.debouncedConvert=v,Object.defineProperty(x,Symbol.toStringTag,{value:"Module"})})(this.KalshiContentScript=this.KalshiContentScript||{},browser);
